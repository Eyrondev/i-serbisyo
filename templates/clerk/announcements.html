<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Announcements - iSerBisyo Clerk</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/iserbisyo_icon.png') }}">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',                           
                            800: '#1e40af',
                            900: '#1e3a8a'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50">
    <div class="min-h-screen flex">
        <!-- Sidebar Container -->
        <div class="hidden lg:block">
            {% include 'components/clerk-sidebar.html' %}
        </div>

        <!-- Main Content Wrapper -->
        <div class="flex-1 lg:pl-64">
            <!-- Header Container -->
            {% include 'components/clerk-header.html' %}

            <!-- Main content area -->
            <main class="flex-1 relative overflow-y-auto focus:outline-none">
                <!-- Announcements Content -->
                <div class="py-3 sm:py-4 lg:py-6">
                    <div class="max-w-full mx-auto px-3 sm:px-4 lg:px-6 xl:px-8">
                        <!-- Modern Page Header -->
                        <div class="mb-8">
                            <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                                    <div class="flex items-center space-x-4 mb-4 lg:mb-0">
                                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                                            <i class="fas fa-bullhorn text-white text-2xl"></i>
                                        </div>
                                        <div>
                                            <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-purple-600 bg-clip-text text-transparent">
                                                Announcements
                                            </h1>
                                            <p class="text-gray-600 text-lg">Create and manage community announcements efficiently</p>
                                        </div>
                                    </div>
                                    <div class="flex flex-wrap gap-3">
                                        <button class="new-announcement-btn inline-flex items-center px-6 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white text-sm font-medium rounded-lg hover:from-purple-700 hover:to-blue-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 shadow-lg hover:shadow-xl transition-all duration-300" onclick="showNewAnnouncementModal()">
                                            <i class="fas fa-plus mr-2"></i>
                                            Create Announcement
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Modern Stats Cards - Full Width -->
                        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 mb-6">
                            <!-- Total Announcements -->
                            <div class="bg-gradient-to-br from-blue-50 to-blue-100 overflow-hidden shadow-lg rounded-xl hover:shadow-xl transition-all duration-300 border border-blue-200 group">
                                <div class="p-6">
                                    <div class="flex items-center justify-between">
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-blue-600 uppercase tracking-wide">Total Announcements</p>
                                            <p class="text-3xl font-bold text-blue-900 mt-2">{{ stats.total_announcements }}</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <div class="w-16 h-16 bg-blue-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                                                <i class="fas fa-bullhorn text-white text-xl"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Published -->
                            <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 overflow-hidden shadow-lg rounded-xl hover:shadow-xl transition-all duration-300 border border-emerald-200 group">
                                <div class="p-6">
                                    <div class="flex items-center justify-between">
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-emerald-600 uppercase tracking-wide">Published</p>
                                            <p class="text-3xl font-bold text-emerald-900 mt-2">{{ stats.published }}</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <div class="w-16 h-16 bg-emerald-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                                                <i class="fas fa-check-circle text-white text-xl"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Draft -->
                            <div class="bg-gradient-to-br from-amber-50 to-amber-100 overflow-hidden shadow-lg rounded-xl hover:shadow-xl transition-all duration-300 border border-amber-200 group">
                                <div class="p-6">
                                    <div class="flex items-center justify-between">
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-amber-600 uppercase tracking-wide">Draft</p>
                                            <p class="text-3xl font-bold text-amber-900 mt-2">{{ stats.draft }}</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <div class="w-16 h-16 bg-amber-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                                                <i class="fas fa-edit text-white text-xl"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Scheduled -->
                            <div class="bg-gradient-to-br from-violet-50 to-violet-100 overflow-hidden shadow-lg rounded-xl hover:shadow-xl transition-all duration-300 border border-violet-200 group">
                                <div class="p-6">
                                    <div class="flex items-center justify-between">
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-violet-600 uppercase tracking-wide">Scheduled</p>
                                            <p class="text-3xl font-bold text-violet-900 mt-2">{{ stats.scheduled }}</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <div class="w-16 h-16 bg-violet-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                                                <i class="fas fa-clock text-white text-xl"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab Navigation -->
                        <div class="mb-6">
                            <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-2">
                                <div class="flex space-x-2">
                                    <!-- Active Announcements Tab -->
                                    <button id="activeTab" class="tab-button flex-1 flex items-center justify-center px-6 py-3 text-sm font-medium rounded-lg transition-all duration-200 bg-gradient-to-r from-purple-600 to-blue-600 text-white shadow-md">
                                        <i class="fas fa-bullhorn mr-2"></i>
                                        Active Announcements
                                        <span id="activeCount" class="ml-2 px-2.5 py-0.5 rounded-full text-xs font-bold bg-white bg-opacity-30">0</span>
                                    </button>
                                    
                                    <!-- Completed Announcements Tab -->
                                    <button id="completedTab" class="tab-button flex-1 flex items-center justify-center px-6 py-3 text-sm font-medium rounded-lg transition-all duration-200 text-gray-600 hover:bg-gray-50">
                                        <i class="fas fa-archive mr-2"></i>
                                        Completed Announcements
                                        <span id="completedCount" class="ml-2 px-2.5 py-0.5 rounded-full text-xs font-bold bg-gray-200 text-gray-700">0</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Modern Filters and Actions -->
                        <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6 mb-6">
                            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                                <!-- Filters -->
                                <div class="flex flex-wrap items-center gap-3">
                                    <!-- Search Input -->
                                    <div class="relative">
                                        <input type="text" id="searchInput" placeholder="Search announcements..." 
                                               value="{{ current_filters.search or '' }}"
                                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full pl-10 p-2.5 hover:bg-gray-100 transition-colors">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-search text-gray-400"></i>
                                        </div>
                                    </div>
                                    
                                    <!-- Status Filter -->
                                    <div class="relative">
                                        <select id="statusFilter" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 pr-8 hover:bg-gray-100 transition-colors">
                                            <option value="">All Status</option>
                                            <option value="published" {{ 'selected' if current_filters.status == 'published' }}>Published</option>
                                            <option value="draft" {{ 'selected' if current_filters.status == 'draft' }}>Draft</option>
                                            <option value="scheduled" {{ 'selected' if current_filters.status == 'scheduled' }}>Scheduled</option>
                                            <option value="archived" {{ 'selected' if current_filters.status == 'archived' }}>Archived</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Category Filter -->
                                    <div class="relative">
                                        <select id="categoryFilter" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 pr-8 hover:bg-gray-100 transition-colors">
                                            <option value="">All Categories</option>
                                            <option value="events" {{ 'selected' if current_filters.category == 'events' }}>Community Events</option>
                                            <option value="health" {{ 'selected' if current_filters.category == 'health' }}>Health & Safety</option>
                                            <option value="government" {{ 'selected' if current_filters.category == 'government' }}>Government Updates</option>
                                            <option value="emergency" {{ 'selected' if current_filters.category == 'emergency' }}>Emergency Alerts</option>
                                            <option value="services" {{ 'selected' if current_filters.category == 'services' }}>Public Services</option>
                                            <option value="general" {{ 'selected' if current_filters.category == 'general' }}>General</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Priority Filter -->
                                    <div class="relative">
                                        <select id="priorityFilter" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 pr-8 hover:bg-gray-100 transition-colors">
                                            <option value="">All Priority</option>
                                            <option value="low" {{ 'selected' if current_filters.priority == 'low' }}>Low</option>
                                            <option value="normal" {{ 'selected' if current_filters.priority == 'normal' }}>Normal</option>
                                            <option value="high" {{ 'selected' if current_filters.priority == 'high' }}>High</option>
                                            <option value="urgent" {{ 'selected' if current_filters.priority == 'urgent' }}>Urgent</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Reset Filter Button -->
                                    <button id="resetFiltersBtn" class="inline-flex items-center px-3 py-2 border border-gray-300 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-50 transition-colors">
                                        <i class="fas fa-times mr-1"></i>
                                        Reset
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Active Filters Display -->
                            {% if current_filters.search or current_filters.status or current_filters.category or current_filters.priority %}
                            <div class="mt-4 flex flex-wrap items-center gap-2">
                                <span class="text-sm font-medium text-gray-700">Active filters:</span>
                                {% if current_filters.search %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                                    Search: "{{ current_filters.search }}"
                                </span>
                                {% endif %}
                                {% if current_filters.status %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    Status: {{ current_filters.status.title() }}
                                </span>
                                {% endif %}
                                {% if current_filters.category %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                    Category: {{ {'events': 'Events', 'health': 'Health & Safety', 'government': 'Government', 'emergency': 'Emergency', 'services': 'Services', 'general': 'General'}.get(current_filters.category, current_filters.category.title()) }}
                                </span>
                                {% endif %}
                                {% if current_filters.priority %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                    Priority: {{ current_filters.priority.title() }}
                                </span>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>

                        <!-- Announcements Grid -->
                        {% if announcements.items %}
                        <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-3" id="announcementsGrid">
                            {% for announcement in announcements.items %}
                            <div class="announcement-card bg-white shadow-sm rounded-lg border {% if announcement.is_pinned %}border-yellow-400 ring-2 ring-yellow-400{% else %}border-gray-100{% endif %} overflow-hidden hover:shadow-md transition-shadow duration-300" data-status="{{ announcement.status }}" data-expiry="{{ announcement.expiry_date if announcement.expiry_date else '' }}">
                                <!-- Header with Category Icon -->
                                <div class="aspect-w-16 aspect-h-9 bg-gradient-to-r 
                                    {% if announcement.category == 'events' %}from-blue-500 to-blue-600
                                    {% elif announcement.category == 'health' %}from-red-500 to-red-600
                                    {% elif announcement.category == 'emergency' %}from-red-600 to-red-700
                                    {% elif announcement.category == 'government' %}from-purple-500 to-purple-600
                                    {% elif announcement.category == 'services' %}from-yellow-500 to-yellow-600
                                    {% else %}from-gray-500 to-gray-600{% endif %}">
                                    <div class="flex items-center justify-center relative">
                                        {% if announcement.is_pinned %}
                                        <div class="absolute top-2 right-2 bg-yellow-400 text-yellow-900 rounded-full p-2 shadow-lg">
                                            <i class="fas fa-thumbtack text-sm"></i>
                                        </div>
                                        {% endif %}
                                        {% if announcement.category == 'events' %}
                                        <i class="fas fa-calendar-alt text-white text-2xl"></i>
                                        {% elif announcement.category == 'health' %}
                                        <i class="fas fa-heart text-white text-2xl"></i>
                                        {% elif announcement.category == 'emergency' %}
                                        <i class="fas fa-exclamation-triangle text-white text-2xl"></i>
                                        {% elif announcement.category == 'government' %}
                                        <i class="fas fa-university text-white text-2xl"></i>
                                        {% elif announcement.category == 'services' %}
                                        <i class="fas fa-tools text-white text-2xl"></i>
                                        {% else %}
                                        <i class="fas fa-info-circle text-white text-2xl"></i>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <!-- Card Content -->
                                <div class="p-4">
                                    <!-- Status and Date Row -->
                                    <div class="flex items-center justify-between mb-2">
                                        <!-- Status Badge -->
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium
                                            {% if announcement.status == 'published' %}bg-green-100 text-green-800
                                            {% elif announcement.status == 'draft' %}bg-yellow-100 text-yellow-800
                                            {% elif announcement.status == 'scheduled' %}bg-purple-100 text-purple-800
                                            {% elif announcement.status == 'archived' %}bg-gray-100 text-gray-800
                                            {% else %}bg-blue-100 text-blue-800{% endif %}">
                                            {{ announcement.formatted_status }}
                                        </span>
                                        
                                        <!-- Priority Badge -->
                                        {% if announcement.priority in ['high', 'urgent'] %}
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium
                                            {% if announcement.priority == 'urgent' %}bg-red-100 text-red-800
                                            {% else %}bg-orange-100 text-orange-800{% endif %}">
                                            {% if announcement.priority == 'urgent' %}
                                            <i class="fas fa-exclamation-circle mr-1"></i>
                                            {% endif %}
                                            {{ announcement.priority.title() }}
                                        </span>
                                        {% endif %}
                                        
                                        <!-- Date -->
                                        <span class="text-xs text-gray-500">
                                            {{ announcement.created_at.strftime('%b %d, %Y') }}
                                        </span>
                                    </div>
                                    
                                    <!-- Special Indicators -->
                                    <div class="flex items-center gap-1 mb-2">
                                        {% if announcement.is_featured %}
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-star-100 text-yellow-700 border border-yellow-200">
                                            <i class="fas fa-star mr-1"></i>
                                            Featured
                                        </span>
                                        {% endif %}
                                        {% if announcement.is_pinned %}
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700 border border-blue-200">
                                            <i class="fas fa-thumbtack mr-1"></i>
                                            Pinned
                                        </span>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Title -->
                                    <h3 class="text-sm font-semibold text-gray-900 mb-2 line-clamp-2">
                                        {{ announcement.title }}
                                    </h3>
                                    
                                    <!-- Excerpt -->
                                    <p class="text-xs text-gray-600 mb-3 line-clamp-3">
                                        {{ announcement.excerpt or announcement.content[:120] + '...' if announcement.content|length > 120 else announcement.content }}
                                    </p>
                                    
                                    <!-- Footer -->
                                    <div class="flex items-center justify-between">
                                        <!-- Category Badge -->
                                        <div class="flex items-center space-x-2">
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium
                                                {% if announcement.category == 'events' %}bg-blue-100 text-blue-800
                                                {% elif announcement.category == 'health' %}bg-red-100 text-red-800
                                                {% elif announcement.category == 'emergency' %}bg-red-100 text-red-800
                                                {% elif announcement.category == 'government' %}bg-purple-100 text-purple-800
                                                {% elif announcement.category == 'services' %}bg-orange-100 text-orange-800
                                                {% else %}bg-gray-100 text-gray-800{% endif %}">
                                                {{ announcement.formatted_category }}
                                            </span>
                                        </div>
                                        
                                        <!-- Action Buttons -->
                                        <div class="flex space-x-1">
                                            <button class="edit-announcement-btn text-green-600 hover:text-green-900 text-xs p-1 rounded hover:bg-green-50" 
                                                    data-announcement-id="{{ announcement.id }}" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            {% if announcement.status == 'draft' %}
                                            <button class="publish-announcement-btn text-emerald-600 hover:text-emerald-900 text-xs p-1 rounded hover:bg-emerald-50" 
                                                    data-announcement-id="{{ announcement.id }}" title="Publish">
                                                <i class="fas fa-paper-plane"></i>
                                            </button>
                                            {% elif announcement.status == 'scheduled' %}
                                            <button class="text-gray-400 text-xs p-1" disabled title="Scheduled">
                                                <i class="fas fa-clock"></i>
                                            </button>
                                            {% endif %}
                                            <button class="delete-announcement-btn text-red-600 hover:text-red-900 text-xs p-1 rounded hover:bg-red-50" 
                                                    data-announcement-id="{{ announcement.id }}" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        
                        <!-- No Active Announcements Message (shown by JavaScript) -->
                        <div id="noActiveMessage" class="text-center py-12" style="display: none;">
                            <div class="w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-inbox text-blue-400 text-3xl"></i>
                            </div>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">No announcements in this category</h3>
                            <p class="text-gray-500">
                                Try switching to another tab or adjusting your filters.
                            </p>
                        </div>
                        {% else %}
                        <!-- No Announcements Message -->
                        <div id="emptyState" class="text-center py-12">
                            <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-bullhorn text-gray-400 text-3xl"></i>
                            </div>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">No announcements found</h3>
                            <p class="text-gray-500 mb-6">
                                {% if current_filters.search or current_filters.status or current_filters.category or current_filters.priority %}
                                Try adjusting your filters or search terms.
                                {% else %}
                                Start by creating your first announcement.
                                {% endif %}
                            </p>
                            {% if not (current_filters.search or current_filters.status or current_filters.category or current_filters.priority) %}
                            <button class="new-announcement-btn inline-flex items-center px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-medium rounded-lg hover:from-purple-700 hover:to-blue-700 transition-colors">
                                <i class="fas fa-plus mr-2"></i>
                                Create Your First Announcement
                            </button>
                            {% endif %}
                        </div>
                        {% endif %}

                        <!-- Pagination -->
                        {% if announcements.items %}
                        <div class="mt-6 flex flex-col sm:flex-row items-center justify-between gap-4">
                            <!-- Results Info -->
                            <div class="text-sm text-gray-600">
                                Showing {{ ((announcements.page - 1) * announcements.per_page) + 1 }} to 
                                {{ ((announcements.page - 1) * announcements.per_page) + announcements.items|length }} 
                                of {{ announcements.total }} announcements
                            </div>
                            
                            <!-- Pagination Controls -->
                            {% if announcements.pages > 1 %}
                            <div class="flex items-center space-x-1">
                                <!-- Previous Button -->
                                {% if announcements.has_prev %}
                                <a href="{{ url_for('clerk.announcements', page=announcements.prev_num, **current_filters) }}" 
                                   class="px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors">
                                    <i class="fas fa-chevron-left mr-1"></i>Previous
                                </a>
                                {% else %}
                                <span class="px-3 py-2 text-sm text-gray-400 cursor-not-allowed">
                                    <i class="fas fa-chevron-left mr-1"></i>Previous
                                </span>
                                {% endif %}
                                
                                <!-- Page Numbers -->
                                {% for page_num in announcements.iter_pages() %}
                                    {% if page_num %}
                                        {% if page_num != announcements.page %}
                                        <a href="{{ url_for('clerk.announcements', page=page_num, **current_filters) }}" 
                                           class="px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors">
                                            {{ page_num }}
                                        </a>
                                        {% else %}
                                        <span class="px-3 py-2 text-sm bg-purple-600 text-white rounded-lg">
                                            {{ page_num }}
                                        </span>
                                        {% endif %}
                                    {% else %}
                                    <span class="px-2 py-2 text-sm text-gray-400">â€¦</span>
                                    {% endif %}
                                {% endfor %}
                                
                                <!-- Next Button -->
                                {% if announcements.has_next %}
                                <a href="{{ url_for('clerk.announcements', page=announcements.next_num, **current_filters) }}" 
                                   class="px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors">
                                    Next<i class="fas fa-chevron-right ml-1"></i>
                                </a>
                                {% else %}
                                <span class="px-3 py-2 text-sm text-gray-400 cursor-not-allowed">
                                    Next<i class="fas fa-chevron-right ml-1"></i>
                                </span>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Load clerk components -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

    <!-- SweetAlert2 CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Announcement Management JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Announcement action handlers
            
            // Edit announcement
            document.querySelectorAll('.edit-announcement-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const announcementId = this.dataset.announcementId;
                    editAnnouncement(announcementId);
                });
            });

            // Publish announcement
            document.querySelectorAll('.publish-announcement-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const announcementId = this.dataset.announcementId;
                    publishAnnouncement(announcementId);
                });
            });

            // Delete announcement
            document.querySelectorAll('.delete-announcement-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const announcementId = this.dataset.announcementId;
                    deleteAnnouncement(announcementId);
                });
            });

            // New Announcement button (for empty state)
            document.querySelectorAll('.new-announcement-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    showNewAnnouncementModal();
                });
            });

            // Filter functionality
            const searchInput = document.getElementById('searchInput');
            const statusFilter = document.getElementById('statusFilter');
            const categoryFilter = document.getElementById('categoryFilter');
            const priorityFilter = document.getElementById('priorityFilter');
            const resetFiltersBtn = document.getElementById('resetFiltersBtn');

            // Debounced search - wait 300ms after user stops typing
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(function() {
                    applyFilters();
                }, 300);
            });

            // Reset filters button click
            resetFiltersBtn.addEventListener('click', function(e) {
                e.preventDefault();
                resetFilters();
            });

            // Auto-apply filters on dropdown change
            [statusFilter, categoryFilter, priorityFilter].forEach(filter => {
                filter.addEventListener('change', function() {
                    applyFilters();
                });
            });

            // Initialize tabs
            setupTabs();
        });

        // Tab Management
        function setupTabs() {
            const activeTab = document.getElementById('activeTab');
            const completedTab = document.getElementById('completedTab');
            const cards = document.querySelectorAll('.announcement-card');
            
            let activeCount = 0;
            let completedCount = 0;
            
            // Check each announcement card for expiry
            cards.forEach(card => {
                const expiryDate = card.dataset.expiry;
                const status = card.dataset.status;
                
                let isCompleted = false;
                
                // Check if expired or archived
                if (status === 'archived') {
                    isCompleted = true;
                } else if (expiryDate && expiryDate.trim() !== '') {
                    try {
                        const expiry = new Date(expiryDate);
                        const now = new Date();
                        if (expiry < now) {
                            isCompleted = true;
                        }
                    } catch (e) {
                        console.error('Error parsing date:', expiryDate, e);
                    }
                }
                
                // Mark the card
                if (isCompleted) {
                    card.dataset.tabType = 'completed';
                    completedCount++;
                } else {
                    card.dataset.tabType = 'active';
                    activeCount++;
                }
            });
            
            // Update counts
            document.getElementById('activeCount').textContent = activeCount;
            document.getElementById('completedCount').textContent = completedCount;
            
            // Tab click handlers
            activeTab.addEventListener('click', () => switchTab('active'));
            completedTab.addEventListener('click', () => switchTab('completed'));
            
            // Show active tab by default
            switchTab('active');
        }

        function switchTab(tabType) {
            const activeTab = document.getElementById('activeTab');
            const completedTab = document.getElementById('completedTab');
            const cards = document.querySelectorAll('.announcement-card');
            const emptyState = document.getElementById('emptyState');
            const noActiveMessage = document.getElementById('noActiveMessage');
            
            // Update tab styles
            if (tabType === 'active') {
                activeTab.className = 'tab-button flex-1 flex items-center justify-center px-6 py-3 text-sm font-medium rounded-lg transition-all duration-200 bg-gradient-to-r from-purple-600 to-blue-600 text-white shadow-md';
                completedTab.className = 'tab-button flex-1 flex items-center justify-center px-6 py-3 text-sm font-medium rounded-lg transition-all duration-200 text-gray-600 hover:bg-gray-50';
            } else {
                activeTab.className = 'tab-button flex-1 flex items-center justify-center px-6 py-3 text-sm font-medium rounded-lg transition-all duration-200 text-gray-600 hover:bg-gray-50';
                completedTab.className = 'tab-button flex-1 flex items-center justify-center px-6 py-3 text-sm font-medium rounded-lg transition-all duration-200 bg-gradient-to-r from-gray-600 to-gray-700 text-white shadow-md';
            }
            
            // Filter cards
            let visibleCount = 0;
            cards.forEach(card => {
                if (card.dataset.tabType === tabType) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Handle empty state
            if (visibleCount === 0) {
                if (noActiveMessage) {
                    noActiveMessage.style.display = 'block';
                    if (tabType === 'completed') {
                        noActiveMessage.querySelector('h3').textContent = 'No completed announcements';
                        noActiveMessage.querySelector('p').textContent = 'Expired or archived announcements will appear here.';
                    } else {
                        noActiveMessage.querySelector('h3').textContent = 'No active announcements';
                        noActiveMessage.querySelector('p').textContent = 'All announcements are either expired or archived.';
                    }
                }
            } else {
                if (noActiveMessage) {
                    noActiveMessage.style.display = 'none';
                }
            }
        }

        // View announcement details
        function viewAnnouncement(announcementId) {
            fetch(`/clerk/api/announcement/${announcementId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const announcement = data.announcement;
                        Swal.fire({
                            title: 'Announcement Details',
                            html: `
                                <div class="text-left space-y-4">
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h2 class="text-xl font-bold text-gray-900 mb-2">${announcement.title}</h2>
                                        <div class="flex flex-wrap gap-2 mb-3">
                                            <span class="px-3 py-1 text-xs font-medium rounded-full ${getStatusBadgeClass(announcement.status)}">
                                                ${announcement.formatted_status}
                                            </span>
                                            <span class="px-3 py-1 text-xs font-medium rounded-full ${getCategoryBadgeClass(announcement.category)}">
                                                ${announcement.formatted_category}
                                            </span>
                                            <span class="px-3 py-1 text-xs font-medium rounded-full ${getPriorityBadgeClass(announcement.priority)}">
                                                ${announcement.priority.charAt(0).toUpperCase() + announcement.priority.slice(1)}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <strong>Created:</strong><br>
                                            <span class="text-gray-600">${new Date(announcement.created_at).toLocaleDateString()}</span>
                                        </div>
                                        <div>
                                            <strong>Author:</strong><br>
                                            <span class="text-gray-600">${announcement.author}</span>
                                        </div>
                                        ${announcement.publish_date ? `
                                        <div>
                                            <strong>Publish Date:</strong><br>
                                            <span class="text-gray-600">${new Date(announcement.publish_date).toLocaleDateString()}</span>
                                        </div>
                                        ` : ''}
                                        ${announcement.expiry_date ? `
                                        <div>
                                            <strong>Expiry Date:</strong><br>
                                            <span class="text-gray-600">${new Date(announcement.expiry_date).toLocaleDateString()}</span>
                                        </div>
                                        ` : ''}
                                    </div>
                                    
                                    ${announcement.excerpt ? `
                                    <div>
                                        <strong>Summary:</strong><br>
                                        <p class="text-gray-600 mt-1">${announcement.excerpt}</p>
                                    </div>
                                    ` : ''}
                                    
                                    <div>
                                        <strong>Content:</strong><br>
                                        <div class="text-gray-600 mt-1 max-h-60 overflow-y-auto border border-gray-200 p-3 rounded">${announcement.content.replace(/\n/g, '<br>')}</div>
                                    </div>
                                    
                                    ${announcement.tags && announcement.tags.length > 0 ? `
                                    <div>
                                        <strong>Tags:</strong><br>
                                        <div class="flex flex-wrap gap-1 mt-1">
                                            ${announcement.tags.map(tag => `<span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded">${tag}</span>`).join('')}
                                        </div>
                                    </div>
                                    ` : ''}
                                    
                                    ${announcement.event_date ? `
                                    <div class="bg-blue-50 p-3 rounded-lg">
                                        <strong>Event Information:</strong><br>
                                        <div class="grid grid-cols-2 gap-2 mt-2 text-sm">
                                            <div><strong>Date:</strong> ${new Date(announcement.event_date).toLocaleDateString()}</div>
                                            ${announcement.event_time ? `<div><strong>Time:</strong> ${announcement.event_time}</div>` : ''}
                                            ${announcement.event_location ? `<div><strong>Location:</strong> ${announcement.event_location}</div>` : ''}
                                            ${announcement.event_organizer ? `<div><strong>Organizer:</strong> ${announcement.event_organizer}</div>` : ''}
                                        </div>
                                    </div>
                                    ` : ''}
                                    
                                    <div class="bg-gray-50 p-3 rounded-lg">
                                        <strong>Notification Settings:</strong><br>
                                        <div class="grid grid-cols-2 gap-2 mt-2 text-sm">
                                            <div><strong>SMS:</strong> ${announcement.send_sms ? 'âœ… Yes' : 'âŒ No'}</div>
                                            <div><strong>Email:</strong> ${announcement.send_email ? 'âœ… Yes' : 'âŒ No'}</div>
                                            <div><strong>Website:</strong> ${announcement.post_on_website ? 'âœ… Yes' : 'âŒ No'}</div>
                                            <div><strong>Push Notification:</strong> ${announcement.notify_residents ? 'âœ… Yes' : 'âŒ No'}</div>
                                        </div>
                                    </div>
                                    
                                    ${announcement.view_count > 0 ? `
                                    <div class="bg-green-50 p-3 rounded-lg">
                                        <strong>Engagement Stats:</strong><br>
                                        <div class="flex gap-4 mt-2 text-sm">
                                            <span><i class="fas fa-eye"></i> ${announcement.view_count} views</span>
                                            <span><i class="fas fa-heart"></i> ${announcement.like_count} likes</span>
                                            <span><i class="fas fa-share"></i> ${announcement.share_count} shares</span>
                                        </div>
                                    </div>
                                    ` : ''}
                                </div>
                            `,
                            width: '800px',
                            confirmButtonText: 'Close',
                            confirmButtonColor: '#dc2626'
                        });
                    } else {
                        Swal.fire('Error', data.message || 'Failed to load announcement details', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    Swal.fire('Error', 'Failed to load announcement details', 'error');
                });
        }

        // Show new announcement modal
        function showNewAnnouncementModal() {
            Swal.fire({
                title: 'Create New Announcement',
                html: `
                    <div class="text-left space-y-4">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                                <input type="text" id="new-title" placeholder="Announcement title" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                                <select id="new-category" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                                    <option value="">Select category</option>
                                    <option value="events">Community Events</option>
                                    <option value="health">Health & Safety</option>
                                    <option value="government">Government Updates</option>
                                    <option value="emergency">Emergency Alerts</option>
                                    <option value="services">Public Services</option>
                                    <option value="general">General</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Summary/Excerpt</label>
                            <textarea id="new-excerpt" rows="2" placeholder="Brief summary of the announcement..." 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Content *</label>
                            <textarea id="new-content" rows="6" placeholder="Write your announcement content here..." 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required></textarea>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                                <select id="new-priority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option value="low">Low</option>
                                    <option value="normal" selected>Normal</option>
                                    <option value="high">High</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Publish Date</label>
                                <input type="date" id="new-publish-date" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Expiry Date</label>
                                <input type="date" id="new-expiry-date" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                        </div>
                    </div>
                `,
                width: '700px',
                showCancelButton: true,
                showDenyButton: true,
                confirmButtonText: 'Publish Now',
                denyButtonText: 'Save as Draft',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#dc2626',
                denyButtonColor: '#6b7280',
                preConfirm: () => {
                    return validateAndGetAnnouncementData(true);
                },
                preDeny: () => {
                    return validateAndGetAnnouncementData(false);
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    createAnnouncement(result.value, true);
                } else if (result.isDenied) {
                    createAnnouncement(result.value, false);
                }
            });
        }

        // Validate and get announcement data from form
        function validateAndGetAnnouncementData(publishNow) {
            const title = document.getElementById('new-title').value.trim();
            const category = document.getElementById('new-category').value;
            const content = document.getElementById('new-content').value.trim();

            // Required fields validation
            if (!title || !category || !content) {
                if (publishNow) {
                    Swal.showValidationMessage('Please fill in all required fields (Title, Category, and Content) before publishing');
                } else {
                    Swal.showValidationMessage('Please fill in all required fields (Title, Category, and Content)');
                }
                return false;
            }

            // Additional validation for title and content length
            if (title.length < 5) {
                Swal.showValidationMessage('Title must be at least 5 characters long');
                return false;
            }

            if (content.length < 10) {
                Swal.showValidationMessage('Content must be at least 10 characters long');
                return false;
            }

            return {
                title: title,
                category: category,
                excerpt: document.getElementById('new-excerpt').value.trim(),
                content: content,
                priority: document.getElementById('new-priority').value,
                publish_date: document.getElementById('new-publish-date').value,
                expiry_date: document.getElementById('new-expiry-date').value,
                publish_now: publishNow
            };
        }

        // Create new announcement
        function createAnnouncement(announcementData, publishNow) {
            fetch('/clerk/api/announcement', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(announcementData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        title: 'Success!',
                        text: `Announcement ${publishNow ? 'published' : 'saved as draft'} successfully!`,
                        icon: 'success',
                        timer: 3000,
                        showConfirmButton: false
                    }).then(() => {
                        location.reload();
                    });
                } else {
                    Swal.fire('Error', data.message || 'Failed to create announcement', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                Swal.fire('Error', 'Failed to create announcement', 'error');
            });
        }

        // Edit announcement
        function editAnnouncement(announcementId) {
            // Fetch announcement details first
            fetch(`/clerk/api/announcement/${announcementId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const announcement = data.announcement;
                        showEditAnnouncementModal(announcement);
                    } else {
                        Swal.fire('Error', data.message || 'Failed to load announcement details', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    Swal.fire('Error', 'Failed to load announcement details', 'error');
                });
        }

        // Show edit announcement modal (implementation similar to create, but pre-populated)
        function showEditAnnouncementModal(announcement) {
            Swal.fire({
                title: 'Edit Announcement',
                html: `
                    <div class="text-left space-y-4">
                        <div class="bg-gray-100 p-3 rounded-lg">
                            <strong>Announcement ID:</strong> ${announcement.id}
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                                <input type="text" id="edit-title" value="${announcement.title}" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                                <select id="edit-category" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                                    <option value="events" ${announcement.category === 'events' ? 'selected' : ''}>Community Events</option>
                                    <option value="health" ${announcement.category === 'health' ? 'selected' : ''}>Health & Safety</option>
                                    <option value="government" ${announcement.category === 'government' ? 'selected' : ''}>Government Updates</option>
                                    <option value="emergency" ${announcement.category === 'emergency' ? 'selected' : ''}>Emergency Alerts</option>
                                    <option value="services" ${announcement.category === 'services' ? 'selected' : ''}>Public Services</option>
                                    <option value="general" ${announcement.category === 'general' ? 'selected' : ''}>General</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Summary/Excerpt</label>
                            <textarea id="edit-excerpt" rows="2" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">${announcement.excerpt || ''}</textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Content *</label>
                            <textarea id="edit-content" rows="6" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500" required>${announcement.content}</textarea>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                <select id="edit-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option value="draft" ${announcement.status === 'draft' ? 'selected' : ''}>Draft</option>
                                    <option value="scheduled" ${announcement.status === 'scheduled' ? 'selected' : ''}>Scheduled</option>
                                    <option value="published" ${announcement.status === 'published' ? 'selected' : ''}>Published</option>
                                    <option value="archived" ${announcement.status === 'archived' ? 'selected' : ''}>Archived</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                                <select id="edit-priority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option value="low" ${announcement.priority === 'low' ? 'selected' : ''}>Low</option>
                                    <option value="normal" ${announcement.priority === 'normal' ? 'selected' : ''}>Normal</option>
                                    <option value="high" ${announcement.priority === 'high' ? 'selected' : ''}>High</option>
                                    <option value="urgent" ${announcement.priority === 'urgent' ? 'selected' : ''}>Urgent</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Expiry Date</label>
                                <input type="date" id="edit-expiry-date" value="${announcement.expiry_date ? announcement.expiry_date.split('T')[0] : ''}"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                        </div>
                        
                        <div class="flex flex-wrap items-center gap-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="edit-is-featured" ${announcement.is_featured ? 'checked' : ''} class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                                <span class="ml-2 text-sm text-gray-700">Featured</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="edit-is-pinned" ${announcement.is_pinned ? 'checked' : ''} class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                                <span class="ml-2 text-sm text-gray-700">Pinned</span>
                            </label>
                        </div>
                    </div>
                `,
                width: '700px',
                showCancelButton: true,
                confirmButtonText: 'Update',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#dc2626',
                preConfirm: () => {
                    const title = document.getElementById('edit-title').value;
                    const category = document.getElementById('edit-category').value;
                    const content = document.getElementById('edit-content').value;

                    if (!title || !category || !content) {
                        Swal.showValidationMessage('Please fill in all required fields');
                        return false;
                    }

                    return {
                        title: title,
                        category: category,
                        excerpt: document.getElementById('edit-excerpt').value,
                        content: content,
                        status: document.getElementById('edit-status').value,
                        priority: document.getElementById('edit-priority').value,
                        expiry_date: document.getElementById('edit-expiry-date').value,
                        is_featured: document.getElementById('edit-is-featured').checked,
                        is_pinned: document.getElementById('edit-is-pinned').checked
                    };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    updateAnnouncement(announcement.id, result.value);
                }
            });
        }

        // Update announcement
        function updateAnnouncement(announcementId, updateData) {
            fetch(`/clerk/api/announcement/${announcementId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(updateData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        title: 'Success!',
                        text: 'Announcement updated successfully',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    }).then(() => {
                        location.reload();
                    });
                } else {
                    Swal.fire('Error', data.message || 'Failed to update announcement', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                Swal.fire('Error', 'Failed to update announcement', 'error');
            });
        }

        // Publish announcement
        function publishAnnouncement(announcementId) {
            Swal.fire({
                title: 'Publish Announcement',
                text: 'Are you sure you want to publish this announcement? It will be visible to the public.',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Yes, Publish',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#dc2626'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch(`/clerk/api/announcement/${announcementId}/publish`, {
                        method: 'POST'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            Swal.fire({
                                title: 'Published!',
                                text: 'Announcement has been published successfully',
                                icon: 'success',
                                timer: 2000,
                                showConfirmButton: false
                            }).then(() => {
                                location.reload();
                            });
                        } else {
                            Swal.fire('Error', data.message || 'Failed to publish announcement', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        Swal.fire('Error', 'Failed to publish announcement', 'error');
                    });
                }
            });
        }

        // Delete announcement
        function deleteAnnouncement(announcementId) {
            Swal.fire({
                title: 'Delete Announcement',
                text: 'Are you sure you want to delete this announcement? This action cannot be undone.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, Delete',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#dc2626'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch(`/clerk/api/announcement/${announcementId}`, {
                        method: 'DELETE'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            Swal.fire({
                                title: 'Deleted!',
                                text: 'Announcement has been deleted successfully',
                                icon: 'success',
                                timer: 2000,
                                showConfirmButton: false
                            }).then(() => {
                                location.reload();
                            });
                        } else {
                            Swal.fire('Error', data.message || 'Failed to delete announcement', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        Swal.fire('Error', 'Failed to delete announcement', 'error');
                    });
                }
            });
        }

        // Apply filters function
        function applyFilters() {
            const search = document.getElementById('searchInput').value;
            const status = document.getElementById('statusFilter').value;
            const category = document.getElementById('categoryFilter').value;
            const priority = document.getElementById('priorityFilter').value;

            // Build query parameters
            const params = new URLSearchParams();
            if (search) params.append('search', search);
            if (status) params.append('status', status);
            if (category) params.append('category', category);
            if (priority) params.append('priority', priority);
            
            // Reset to page 1
            params.append('page', '1');
            
            // Redirect with filters
            window.location.href = `${window.location.pathname}?${params.toString()}`;
        }

        // Reset filters function
        function resetFilters() {
            // Clear all filter inputs
            document.getElementById('searchInput').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('priorityFilter').value = '';
            
            // Redirect without filters
            window.location.href = window.location.pathname;
        }

        // Helper functions for styling
        function getStatusBadgeClass(status) {
            const classes = {
                'published': 'bg-green-100 text-green-800',
                'draft': 'bg-yellow-100 text-yellow-800',
                'scheduled': 'bg-purple-100 text-purple-800',
                'archived': 'bg-gray-100 text-gray-800'
            };
            return classes[status] || 'bg-blue-100 text-blue-800';
        }

        function getCategoryBadgeClass(category) {
            const classes = {
                'events': 'bg-blue-100 text-blue-800',
                'health': 'bg-red-100 text-red-800',
                'emergency': 'bg-red-100 text-red-800',
                'government': 'bg-purple-100 text-purple-800',
                'services': 'bg-orange-100 text-orange-800',
                'general': 'bg-gray-100 text-gray-800'
            };
            return classes[category] || 'bg-gray-100 text-gray-800';
        }

        function getPriorityBadgeClass(priority) {
            const classes = {
                'low': 'bg-gray-100 text-gray-800',
                'normal': 'bg-blue-100 text-blue-800',
                'high': 'bg-orange-100 text-orange-800',
                'urgent': 'bg-red-100 text-red-800'
            };
            return classes[priority] || 'bg-blue-100 text-blue-800';
        }
    </script>
</body>
</html>